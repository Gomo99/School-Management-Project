@model SchoolProject.ViewModel.DashboardViewModel

@{
    Layout = "~/Views/Shared/_Layout.cshtml";
    ViewData["Title"] = "Admin Dashboard";
}

@section Sidebar {
    @await Html.PartialAsync("_SidebarPartial")
}
<partial name="_NotificationPartial" />

<!-- Header Section -->
<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h1 class="h2 fw-bold text-primary mb-1">
            <i class="bi bi-speedometer2 me-2"></i>Admin Dashboard
        </h1>
        <p class="text-muted mb-0">Welcome back! Here's an overview of your system.</p>
    </div>
    <div class="d-flex gap-2">
        <button id="refreshDashboard" class="btn btn-outline-primary btn-sm rounded-pill">
            <i class="bi bi-arrow-repeat me-1"></i>Refresh
        </button>
       
    </div>
</div>

<!-- Stats Cards Row -->
<div class="row g-4 mb-4">
    <!-- Active Modules Card -->
    <div class="col-xl-4 col-md-6">
        <div class="card border-0 shadow-sm h-100 hover-lift">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="bg-success bg-opacity-10 p-3 rounded-circle">
                        <i class="bi bi-check-circle-fill text-success fs-4"></i>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-success bg-opacity-25 text-success">+12%</span>
                    </div>
                </div>
                <h3 class="fw-bold text-dark mb-1">@Model.ActiveModulesCount</h3>
                <p class="text-muted mb-2">Active Modules</p>
                <div class="progress mb-3" style="height: 4px;">
                    <div class="progress-bar bg-success" style="width: @Model.ActivePercentage%"></div>
                </div>
                <a href="@Url.Action("ManageModules", new { status = "Active" })"
                   class="stretched-link text-decoration-none">
                    <span class="small text-primary">View all active modules <i class="bi bi-arrow-right"></i></span>
                </a>
            </div>
        </div>
    </div>

    <!-- Inactive Modules Card -->
    <div class="col-xl-4 col-md-6">
        <div class="card border-0 shadow-sm h-100 hover-lift">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="bg-danger bg-opacity-10 p-3 rounded-circle">
                        <i class="bi bi-x-circle-fill text-danger fs-4"></i>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-danger bg-opacity-25 text-danger">-5%</span>
                    </div>
                </div>
                <h3 class="fw-bold text-dark mb-1">@Model.InactiveModulesCount</h3>
                <p class="text-muted mb-2">Inactive Modules</p>
                <div class="progress mb-3" style="height: 4px;">
                    <div class="progress-bar bg-danger" style="width: @Model.InactivePercentage%"></div>
                </div>
                <a href="@Url.Action("ManageModules", new { status = "Inactive" })"
                   class="stretched-link text-decoration-none">
                    <span class="small text-primary">Review inactive modules <i class="bi bi-arrow-right"></i></span>
                </a>
            </div>
        </div>
    </div>

    <!-- Total Modules Card -->
    <div class="col-xl-4 col-md-6">
        <div class="card border-0 shadow-sm h-100 hover-lift">
            <div class="card-body p-4">
                <div class="d-flex justify-content-between align-items-center mb-3">
                    <div class="bg-primary bg-opacity-10 p-3 rounded-circle">
                        <i class="bi bi-collection-fill text-primary fs-4"></i>
                    </div>
                    <div class="text-end">
                        <span class="badge bg-primary bg-opacity-25 text-primary">+7%</span>
                    </div>
                </div>
                <h3 class="fw-bold text-dark mb-1">@Model.TotalModules</h3>
                <p class="text-muted mb-2">Total Modules</p>
                <div class="progress mb-3" style="height: 4px;">
                    <div class="progress-bar bg-primary" style="width: 100%"></div>
                </div>
                <a href="@Url.Action("ManageModules")"
                   class="stretched-link text-decoration-none">
                    <span class="small text-primary">Manage all modules <i class="bi bi-arrow-right"></i></span>
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Additional Stats Row -->
<div class="row g-4 mb-4">
    <!-- Recent Activity Card -->
    <div class="col-xl-8">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-transparent border-0 py-4">
                <h5 class="card-title mb-0 text-dark">
                    <i class="bi bi-activity me-2 text-primary"></i>Recent Activity
                </h5>
            </div>
            <div class="card-body">
                <div class="table-responsive">
                    <table class="table table-hover align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>User</th>
                                <th>-</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var account in Model.RecentAccounts)
                            {
                                <tr>
                                    <td>@account.Name @account.Surname</td>
                                    <td>Registered</td>
                                    <td>@DateTime.Now.ToShortTimeString()</td>
                                    <td><span class="badge bg-success">Active</span></td>
                                </tr>
                            }
                        </tbody>

                    </table>
                </div>
                <a href="#" class="btn btn-outline-primary w-100 mt-3 rounded-pill">
                    <i class="bi bi-list-check me-2"></i>View Full Activity Log
                </a>
            </div>
        </div>
    </div>

    <!-- Quick Actions Card -->
    <div class="col-xl-4">
        <div class="card border-0 shadow-sm h-100">
            <div class="card-header bg-transparent border-0 py-4">
                <h5 class="card-title mb-0 text-dark">
                    <i class="bi bi-lightning-fill me-2 text-warning"></i>Quick Actions
                </h5>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="@Url.Action("CreateModule")" class="btn btn-primary rounded-pill py-3">
                        <i class="bi bi-plus-circle me-2"></i>Create New Module
                    </a>
                    <a href="@Url.Action("ManageUsers")" class="btn btn-outline-primary rounded-pill py-3">
                        <i class="bi bi-people me-2"></i>Manage Users
                    </a>
                    <a href="@Url.Action("Reports")" class="btn btn-outline-secondary rounded-pill py-3">
                        <i class="bi bi-bar-chart me-2"></i>View Reports
                    </a>
                    <a href="@Url.Action("Settings")" class="btn btn-outline-dark rounded-pill py-3">
                        <i class="bi bi-gear me-2"></i>System Settings
                    </a>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- System Status Row -->
<div class="row g-4">
    <!-- System Health Card -->
    <div class="col-xl-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-transparent border-0 py-4">
                <h5 class="card-title mb-0 text-dark">
                    <i class="bi bi-heart-pulse me-2 text-success"></i>System Health
                </h5>
            </div>
            <div class="card-body">
                <div class="row g-3">
                    <div class="col-md-6">
                        <div class="d-flex align-items-center p-3 bg-light rounded-3">
                            <div class="bg-success bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="bi bi-database-check text-success"></i>
                            </div>
                            <div>
                                <small class="text-muted d-block">Database</small>
                                <span class="fw-semibold">Healthy</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center p-3 bg-light rounded-3">
                            <div class="bg-success bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="bi bi-server text-success"></i>
                            </div>
                            <div>
                                <small class="text-muted d-block">Server</small>
                                <span class="fw-semibold">Online</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center p-3 bg-light rounded-3">
                            <div class="bg-warning bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="bi bi-shield-check text-warning"></i>
                            </div>
                            <div>
                                <small class="text-muted d-block">Security</small>
                                <span class="fw-semibold">Monitoring</span>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="d-flex align-items-center p-3 bg-light rounded-3">
                            <div class="bg-info bg-opacity-10 p-3 rounded-circle me-3">
                                <i class="bi bi-cloud-check text-info"></i>
                            </div>
                            <div>
                                <small class="text-muted d-block">Backup</small>
                                <span class="fw-semibold">24h ago</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent Notifications Card -->
    <div class="col-xl-6">
        <div class="card border-0 shadow-sm">
            <div class="card-header bg-transparent border-0 py-4">
                <h5 class="card-title mb-0 text-dark">
                    <i class="bi bi-bell-fill me-2 text-primary"></i>Recent Notifications
                </h5>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item border-0 px-0 py-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-success bg-opacity-10 p-2 rounded-circle me-3">
                                <i class="bi bi-check-circle text-success"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">New user registration</h6>
                                <p class="text-muted mb-0 small">2 minutes ago</p>
                            </div>
                            <span class="badge bg-success">New</span>
                        </div>
                    </div>
                    <div class="list-group-item border-0 px-0 py-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-warning bg-opacity-10 p-2 rounded-circle me-3">
                                <i class="bi bi-exclamation-triangle text-warning"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">Module update required</h6>
                                <p class="text-muted mb-0 small">15 minutes ago</p>
                            </div>
                            <span class="badge bg-warning">Alert</span>
                        </div>
                    </div>
                    <div class="list-group-item border-0 px-0 py-3">
                        <div class="d-flex align-items-center">
                            <div class="bg-info bg-opacity-10 p-2 rounded-circle me-3">
                                <i class="bi bi-info-circle text-info"></i>
                            </div>
                            <div class="flex-grow-1">
                                <h6 class="mb-1">System maintenance scheduled</h6>
                                <p class="text-muted mb-0 small">1 hour ago</p>
                            </div>
                            <span class="badge bg-info">Info</span>
                        </div>
                    </div>
                </div>
                <a href="#" class="btn btn-outline-primary w-100 mt-3 rounded-pill">
                    <i class="bi bi-bell me-2"></i>View All Notifications
                </a>
            </div>
        </div>
    </div>
</div>

<!-- Bootstrap Icons -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.0/font/bootstrap-icons.css">

<style>
    .hover-lift {
        transition: all 0.3s ease;
    }

        .hover-lift:hover {
            transform: translateY(-5px);
            box-shadow: 0 0.5rem 1.5rem rgba(0, 0, 0, 0.15) !important;
        }

    .card {
        border-radius: 1rem;
    }

    .progress {
        border-radius: 1rem;
        overflow: hidden;
    }

    .bg-opacity-10 {
        opacity: 0.1;
    }

    .list-group-item {
        border-radius: 0.75rem;
        margin-bottom: 0.5rem;
    }

        .list-group-item:hover {
            background-color: #f8f9fa;
        }

    .rounded-circle {
        transition: all 0.3s ease;
    }

    .card:hover .rounded-circle {
        transform: scale(1.1);
    }

    .stretched-link::after {
        border-radius: 1rem;
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Add smooth animations
        const cards = document.querySelectorAll('.card');
        cards.forEach((card, index) => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'all 0.5s ease';

            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, index * 100);
        });

        // Refresh button functionality
        document.querySelector('.btn-outline-primary').addEventListener('click', function() {
            this.innerHTML = '<span class="spinner-border spinner-border-sm me-2"></span>Refreshing...';
            setTimeout(() => {
                location.reload();
            }, 1000);
        });
    });

    document.getElementById('refreshDashboard').addEventListener('click', function() {
    // Example: Fetch updated data and update #dashboardContent
    fetch('/Dashboard/GetDashboardData') // Endpoint to get updated data
        .then(response => response.json())
        .then(data => {
            // Update the dashboardContent div with new data
            document.getElementById('dashboardContent').innerHTML = ''; // Clear old content
            // Populate with new data (example)
            data.forEach(item => {
                // Append new content based on data
                document.getElementById('dashboardContent').innerHTML += `<p>${item.someProperty}</p>`;
            });
        })
        .catch(error => console.error('Error refreshing dashboard:', error));
});

</script>